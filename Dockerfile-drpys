FROM node:22.16.0-alpine

# 设置时区
RUN apk add --no-cache tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone

# 使用 apk 安装依赖（包含 coreutils 解决 nohup 问题）
RUN apk add --no-cache \
    python3 \
    py3-pip \
    py3-setuptools \
    py3-wheel \
    gcc \
    musl-dev \
    python3-dev \
    nodejs npm \
    bash \
    curl \
    coreutils  # 确保 nohup 可用

# 安装必要的Python包，注意命令中不要有中文字符
RUN python3 -m ensurepip --upgrade && \
    pip3 install --no-cache-dir --upgrade pip && \
    pip3 install --no-cache-dir \
    requests \
    lxml \
    pycryptodome \
    ujson \
    pyquery \
    jsonpath \
    json5 \
    jinja2 \
    cachetools \
    pympler
    
WORKDIR /drpy-node

EXPOSE 5757

CMD ["node" "index.js"]
