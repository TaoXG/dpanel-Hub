# 用Python官方Alpine镜像（pip环境天然正确，无路径问题）
FROM python:3.11-alpine3.20

# 1. 安装Node环境（满足你的Node需求）
RUN apk add --no-cache nodejs npm bash tzdata coreutils

# 2. 复制本地下载的依赖包和requirements.txt到容器
COPY packages /app/packages
COPY requirements.txt /app/requirements.txt

# 3. 离线安装Python依赖（完全不依赖外部网络）
RUN python -m pip install --no-cache-dir --no-index --find-links=/app/packages -r /app/requirements.txt

# 4. 设置时区
RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone

# 5. 工作目录和端口
WORKDIR /drpy-node
EXPOSE 5757
CMD ["node", "index.js"]
