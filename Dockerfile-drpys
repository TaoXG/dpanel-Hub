FROM node:22.16.0-alpine

# 清除缓存并更新系统
RUN apk update && apk upgrade && rm -rf /var/cache/apk/*

# 设置时区
RUN apk add --no-cache tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone && \
    rm -rf /var/cache/apk/*

# 使用 apk 安装依赖
RUN apk add --no-cache \
    python3 \
    py3-pip \
    py3-setuptools \
    py3-wheel \
    gcc \
    musl-dev \
    python3-dev \
    libxml2-dev \
    libxslt-dev \
    nodejs \
    npm \
    bash \
    curl \
    coreutils && \
    rm -rf /var/cache/apk/*

# 安装必要的Python包
RUN python3 -m ensurepip --upgrade && \
    pip3 install --no-cache-dir --upgrade pip && \
    pip3 install --no-cache-dir \
    requests \
    lxml \
    pycryptodome \
    ujson \
    pyquery \
    jsonpath \
    json5 \
    jinja2 \
    cachetools \
    pympler

WORKDIR /drpy-node

EXPOSE 5757

CMD ["node" "index.js"]
