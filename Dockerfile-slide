# 使用Alpine镜像（体积<100MB，无QEMU兼容问题）
FROM python:3.9-alpine

# 设置环境变量：禁用缓存、强制国内源
ENV PIP_NO_CACHE_DIR=1
ENV PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple

# 安装Alpine必需的基础依赖（仅5MB）
RUN apk add --no-cache \
    libgcc \
    musl-dev \
    zlib-dev \
    jpeg-dev

# 安装Python包（纯预编译，无源码编译）
RUN pip install \
    pillow==9.5.0 \    # 适配Alpine的稳定版本
    numpy==1.23.5 \
    bottle==0.12.25

# 工作目录
WORKDIR /app

# 复制脚本（使用纯PIL版本的slide_match.py）
COPY slide.py .

# 暴露端口
EXPOSE 3001

# 启动命令
CMD ["python", "-u", "slide.py"]
